window.__require=function e(t,r,n){function a(i,c){if(!r[i]){if(!t[i]){var l=i.split("/");if(l=l[l.length-1],!t[l]){var f="function"==typeof __require&&__require;if(!c&&f)return f(l,!0);if(o)return o(l,!0);throw new Error("Cannot find module '"+i+"'")}i=l}var u=r[i]={exports:{}};t[i][0].call(u.exports,function(e){return a(t[i][1][e]||e)},u,u.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof __require&&__require,i=0;i<n.length;i++)a(n[i]);return a}({lanuch:[function(e,t,r){"use strict";cc._RF.push(t,"46ff1bjlrRFb5ioGd80wKts","lanuch");var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),a=this&&this.__decorate||function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i};Object.defineProperty(r,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,c=o.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.honourSp=[],t.itemPrefab=null,t.friendCloudData=null,t.selfAvatarUrl="",t}return n(t,e),t.prototype.onLoad=function(){this.getSelfAvatarUrl()},t.prototype.start=function(){var e=this;wx.onMessage(function(t){switch(t.type){case"friend":e.openFriendRank();break;case"hide":e.hideFriendRank()}})},t.prototype.getSelfAvatarUrl=function(){var e=this;wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(t){e.selfAvatarUrl=t.data[0].avatarUrl},fail:function(e){console.log("getSelfAvatarUrl fail",e)}})},t.prototype.openFriendRank=function(){var e=this;this.node.getChildByName("rankRoot").active=!0,wx.getFriendCloudStorage({keyList:["maxLevel","userId"],success:function(t){e.friendCloudData=t.data,e.drawFriendRank()},fail:function(e){},complete:function(e){}})},t.prototype.drawFriendRank=function(){var e=this,t=this.friendDataFormat(this.friendCloudData),r=cc.find("Canvas/rankRoot/self");this.setData(r,t.self);var n=cc.find("Canvas/rankRoot/view/content");n.removeAllChildren(),t.other.forEach(function(t){var r=cc.instantiate(e.itemPrefab);n.addChild(r),e.setData(r,t)})},t.prototype.setData=function(e,t){var r=e.getChildByName("rank").getChildByName("honour"),n=e.getChildByName("rank").getChildByName("number"),a=e.getChildByName("avatar"),o=e.getChildByName("nickName"),i=e.getChildByName("maxLevel");t.rank<4?(r.getComponent(cc.Sprite).spriteFrame=this.honourSp[t.rank-1],n.active=!1):(r.active=!1,n.getComponent(cc.Label).string=t.rank+""),this.createImage(a.getComponent(cc.Sprite),t.avatarUrl),o.getComponent(cc.Label).string=t.nickName.substring(0,7),i.getComponent(cc.RichText).string="\u7b2c<color=#fff6a9><outline color=#cf2200 width=1> "+(Math.floor(t.maxLevel)+1)+" </outline></color>\u5173"},t.prototype.createImage=function(e,t){var r=wx.createImage();r.onload=function(){var t=new cc.Texture2D;t.initWithElement(r),t.handleLoadedTexture(),e.spriteFrame=new cc.SpriteFrame(t)},r.src=t},t.prototype.hideFriendRank=function(){this.node.getChildByName("rankRoot").active=!1},t.prototype.friendDataFormat=function(e){var t=this,r=0,n=[];this.compare(e,"maxLevel").forEach(function(e,a){var o=0;e.KVDataList.forEach(function(e){"maxLevel"==e.key&&(o=e.value)}),n.push({nickName:e.nickname,avatarUrl:e.avatarUrl,maxLevel:o,rank:a+1}),e.avatarUrl==t.selfAvatarUrl&&(r=a)});var a={self:null,other:null};return a.self=n[r],a.other=n,a},t.prototype.compare=function(e,t){return e.sort(function(e,r){var n=0,a=0;return e.KVDataList.forEach(function(e){e.key==t&&(n=e.value)}),r.KVDataList.forEach(function(e){e.key==t&&(a=e.value)}),a-n}),e},a([c(cc.SpriteFrame)],t.prototype,"honourSp",void 0),a([c(cc.Prefab)],t.prototype,"itemPrefab",void 0),t=a([i],t)}(cc.Component);r.default=l,cc._RF.pop()},{}]},{},["lanuch"]);